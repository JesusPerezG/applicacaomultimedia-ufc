<!DOCTYPE html>  <html> <head>   <title>Client.java</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               Client.java             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="kn">package</span> <span class="n">pratica01</span><span class="o">;</span>
<span class="cm">/* ------------------</span>
<span class="cm">   Client</span>
<span class="cm">   usage: java Client [Server hostname] [Server RTSP listening port] [Video file requested]</span>
<span class="cm">   ---------------------- */</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h2>How to use the client</h2>

<ol>
<li>Compile with javac </li>
<li><p>Run : <em>java Client [Server hostname] [Server RTSP listening port] [Video file requested path] [Listening RTP Client Port]</em></p>

<p>example: <code>java 127.0.0.1 3000 src/pratica01/movie.Mjpeg 2500</code></p></li>
</ol>             </td>             <td class="code">               <div class="highlight"><pre><span class="kn">import</span> <span class="nn">java.io.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.net.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.awt.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.awt.event.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.swing.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.swing.Timer</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Client</span><span class="o">{</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <h2>Variables</h2>

<h3>GUI variables</h3>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="n">JFrame</span> <span class="n">f</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JFrame</span><span class="o">(</span><span class="s">&quot;Client&quot;</span><span class="o">);</span>
  <span class="n">JButton</span> <span class="n">setupButton</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JButton</span><span class="o">(</span><span class="s">&quot;Setup&quot;</span><span class="o">);</span>
  <span class="n">JButton</span> <span class="n">playButton</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JButton</span><span class="o">(</span><span class="s">&quot;Play&quot;</span><span class="o">);</span>
  <span class="n">JButton</span> <span class="n">pauseButton</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JButton</span><span class="o">(</span><span class="s">&quot;Pause&quot;</span><span class="o">);</span>
  <span class="n">JButton</span> <span class="n">tearButton</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JButton</span><span class="o">(</span><span class="s">&quot;Teardown&quot;</span><span class="o">);</span>
  <span class="n">JPanel</span> <span class="n">mainPanel</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JPanel</span><span class="o">();</span>
  <span class="n">JPanel</span> <span class="n">buttonPanel</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JPanel</span><span class="o">();</span>
  <span class="n">JLabel</span> <span class="n">iconLabel</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JLabel</span><span class="o">();</span>
  <span class="n">ImageIcon</span> <span class="n">icon</span><span class="o">;</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <h3>RTP variables:</h3>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="n">DatagramPacket</span> <span class="n">rcvdp</span><span class="o">;</span> <span class="c1">//UDP packet received from the server</span>
  <span class="n">DatagramSocket</span> <span class="n">RTPsocket</span><span class="o">;</span> <span class="c1">//socket to be used to send and receive UDP packets</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="n">RTP_RCV_PORT</span><span class="o">;</span> <span class="c1">//port where the client will receive the RTP packets</span>

  <span class="n">Timer</span> <span class="n">timer</span><span class="o">;</span> <span class="c1">//timer used to receive data from the UDP socket</span>
  <span class="kt">byte</span><span class="o">[]</span> <span class="n">buf</span><span class="o">;</span> <span class="c1">//buffer used to store data received from the server</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <h3>RTSP variables</h3>

<ul>
<li>rtsp states</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">final</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">INIT</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
  <span class="kd">final</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">READY</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
  <span class="kd">final</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">PLAYING</span> <span class="o">=</span> <span class="mi">2</span><span class="o">;</span>
  <span class="kd">static</span> <span class="kt">int</span> <span class="n">state</span><span class="o">;</span> <span class="c1">//RTSP state == INIT or READY or PLAYING</span>
  <span class="n">Socket</span> <span class="n">RTSPsocket</span><span class="o">;</span> <span class="c1">//socket used to send/receive RTSP messages</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <ul>
<li>input and output stream filters</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">public</span> <span class="n">BufferedReader</span> <span class="n">RTSPBufferedReader</span><span class="o">;</span>
  <span class="kd">public</span> <span class="n">BufferedWriter</span> <span class="n">RTSPBufferedWriter</span><span class="o">;</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="n">VideoFileName</span><span class="o">;</span> <span class="c1">//video file to request to the server</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="n">RTSPSeqNb</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="c1">//Sequence number of RTSP messages within the session</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="n">RTSPid</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="c1">//ID of the RTSP session (given by the RTSP Server)</span>

  <span class="kd">final</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">CRLF</span> <span class="o">=</span> <span class="s">&quot;\r\n&quot;</span><span class="o">;</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <ul>
<li>video constants</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">static</span> <span class="kt">int</span> <span class="n">MJPEG_TYPE</span> <span class="o">=</span> <span class="mi">26</span><span class="o">;</span> <span class="c1">//RTP payload type for MJPEG video</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <h2>Constructor</h2>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">public</span> <span class="nf">Client</span><span class="o">()</span> <span class="o">{</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <h3>Build GUI</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <ul>
<li>frame</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="n">f</span><span class="o">.</span><span class="na">addWindowListener</span><span class="o">(</span><span class="k">new</span> <span class="n">WindowAdapter</span><span class="o">()</span> <span class="o">{</span>
       <span class="kd">public</span> <span class="kt">void</span> <span class="nf">windowClosing</span><span class="o">(</span><span class="n">WindowEvent</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
	 <span class="n">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
       <span class="o">}</span>
    <span class="o">});</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <ul>
<li>init buttons linked to handlers</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="n">buttonPanel</span><span class="o">.</span><span class="na">setLayout</span><span class="o">(</span><span class="k">new</span> <span class="n">GridLayout</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="mi">0</span><span class="o">));</span>
    <span class="n">buttonPanel</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">setupButton</span><span class="o">);</span>
    <span class="n">buttonPanel</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">playButton</span><span class="o">);</span>
    <span class="n">buttonPanel</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">pauseButton</span><span class="o">);</span>
    <span class="n">buttonPanel</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">tearButton</span><span class="o">);</span>
    <span class="n">setupButton</span><span class="o">.</span><span class="na">addActionListener</span><span class="o">(</span><span class="k">new</span> <span class="n">setupButtonListener</span><span class="o">());</span>
    <span class="n">playButton</span><span class="o">.</span><span class="na">addActionListener</span><span class="o">(</span><span class="k">new</span> <span class="n">playButtonListener</span><span class="o">());</span>
    <span class="n">pauseButton</span><span class="o">.</span><span class="na">addActionListener</span><span class="o">(</span><span class="k">new</span> <span class="n">pauseButtonListener</span><span class="o">());</span>
    <span class="n">tearButton</span><span class="o">.</span><span class="na">addActionListener</span><span class="o">(</span><span class="k">new</span> <span class="n">tearButtonListener</span><span class="o">());</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <ul>
<li>image display label</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="n">iconLabel</span><span class="o">.</span><span class="na">setIcon</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <ul>
<li>frame layout</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="n">mainPanel</span><span class="o">.</span><span class="na">setLayout</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
    <span class="n">mainPanel</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">iconLabel</span><span class="o">);</span>
    <span class="n">mainPanel</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">buttonPanel</span><span class="o">);</span>
    <span class="n">iconLabel</span><span class="o">.</span><span class="na">setBounds</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">380</span><span class="o">,</span><span class="mi">280</span><span class="o">);</span>
    <span class="n">buttonPanel</span><span class="o">.</span><span class="na">setBounds</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="mi">280</span><span class="o">,</span><span class="mi">380</span><span class="o">,</span><span class="mi">50</span><span class="o">);</span>

    <span class="n">f</span><span class="o">.</span><span class="na">getContentPane</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="n">mainPanel</span><span class="o">,</span> <span class="n">BorderLayout</span><span class="o">.</span><span class="na">CENTER</span><span class="o">);</span>
    <span class="n">f</span><span class="o">.</span><span class="na">setSize</span><span class="o">(</span><span class="k">new</span> <span class="n">Dimension</span><span class="o">(</span><span class="mi">390</span><span class="o">,</span><span class="mi">370</span><span class="o">));</span>
    <span class="n">f</span><span class="o">.</span><span class="na">setVisible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <h3>Init timer</h3>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="n">timer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Timer</span><span class="o">(</span><span class="mi">20</span><span class="o">,</span> <span class="k">new</span> <span class="n">timerListener</span><span class="o">());</span>
    <span class="n">timer</span><span class="o">.</span><span class="na">setInitialDelay</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
    <span class="n">timer</span><span class="o">.</span><span class="na">setCoalesce</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <h3>Init buffer</h3>

<ul>
<li>allocate enough memory for the buffer used to receive data from the server</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="n">buf</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="mi">15000</span><span class="o">];</span>
  <span class="o">}</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <h2>Main</h2>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span> <span class="n">argv</span><span class="o">[])</span> <span class="kd">throws</span> <span class="n">Exception</span>
  <span class="o">{</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <ul>
<li>create a Client object</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="n">Client</span> <span class="n">theClient</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Client</span><span class="o">();</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <ul>
<li>get server RTSP port and IP address from the command line</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kt">int</span> <span class="n">RTSP_server_port</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">argv</span><span class="o">[</span><span class="mi">1</span><span class="o">]);</span>
    <span class="n">String</span> <span class="n">ServerHost</span> <span class="o">=</span> <span class="n">argv</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
    <span class="n">InetAddress</span> <span class="n">ServerIPAddr</span> <span class="o">=</span> <span class="n">InetAddress</span><span class="o">.</span><span class="na">getByName</span><span class="o">(</span><span class="n">ServerHost</span><span class="o">);</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <ul>
<li>get video filename to request:</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="n">theClient</span><span class="o">.</span><span class="na">VideoFileName</span> <span class="o">=</span> <span class="n">argv</span><span class="o">[</span><span class="mi">2</span><span class="o">];</span>
    </pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <ul>
<li>get RTP Receive Port from the command line</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="n">theClient</span><span class="o">.</span><span class="na">RTP_RCV_PORT</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">argv</span><span class="o">[</span><span class="mi">3</span><span class="o">]);</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <ul>
<li>establish a TCP connection with the server to exchange RTSP messages</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="n">theClient</span><span class="o">.</span><span class="na">RTSPsocket</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Socket</span><span class="o">(</span><span class="n">ServerIPAddr</span><span class="o">,</span> <span class="n">RTSP_server_port</span><span class="o">);</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <ul>
<li>set input and output stream filters:</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="n">theClient</span><span class="o">.</span><span class="na">RTSPBufferedReader</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="n">theClient</span><span class="o">.</span><span class="na">RTSPsocket</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">())</span> <span class="o">);</span>
    <span class="n">theClient</span><span class="o">.</span><span class="na">RTSPBufferedWriter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedWriter</span><span class="o">(</span><span class="k">new</span> <span class="n">OutputStreamWriter</span><span class="o">(</span><span class="n">theClient</span><span class="o">.</span><span class="na">RTSPsocket</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">())</span> <span class="o">);</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <ul>
<li>init RTSP state:</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="n">state</span> <span class="o">=</span> <span class="n">INIT</span><span class="o">;</span>
    
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Init Success&quot;</span><span class="o">);</span>
  <span class="o">}</span>
  </pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <h2>Handlers for buttons Setup,Play,Pause,Teardown</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <h3>Setup button handler</h3>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">class</span> <span class="nc">setupButtonListener</span> <span class="kd">implements</span> <span class="n">ActionListener</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">actionPerformed</span><span class="o">(</span><span class="n">ActionEvent</span> <span class="n">e</span><span class="o">){</span>

      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Setup Button pressed !&quot;</span><span class="o">);</span>

      <span class="k">if</span> <span class="o">(</span><span class="n">state</span> <span class="o">==</span> <span class="n">INIT</span><span class="o">)</span>
	<span class="o">{</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <ul>
<li>init non-blocking RTPsocket that will be used to receive data</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>	  <span class="k">try</span><span class="o">{</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p><em>construct a new DatagramSocket to receive RTP packets from the server, on port RTP_RCV_PORT</em></p>             </td>             <td class="code">               <div class="highlight"><pre>	    <span class="n">RTPsocket</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DatagramSocket</span><span class="o">(</span><span class="n">RTP_RCV_PORT</span><span class="o">);</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p><em>set TimeOut value of the socket to 5msec.</em></p>             </td>             <td class="code">               <div class="highlight"><pre>	    <span class="n">RTPsocket</span><span class="o">.</span><span class="na">setSoTimeout</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span>

	  <span class="o">}</span>
	  <span class="k">catch</span> <span class="o">(</span><span class="n">SocketException</span> <span class="n">se</span><span class="o">)</span>
	    <span class="o">{</span>
	      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Socket exception: &quot;</span><span class="o">+</span><span class="n">se</span><span class="o">);</span>
	      <span class="n">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
	    <span class="o">}</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <ul>
<li>init RTSP sequence number</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>	  <span class="n">RTSPSeqNb</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <ul>
<li>send SETUP message to the server</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>	  <span class="n">send_RTSP_request</span><span class="o">(</span><span class="s">&quot;SETUP&quot;</span><span class="o">);</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <ul>
<li>wait for the response</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>	  <span class="k">if</span> <span class="o">(</span><span class="n">parse_server_response</span><span class="o">()</span> <span class="o">!=</span> <span class="mi">200</span><span class="o">)</span>
	    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Invalid Server Response&quot;</span><span class="o">);</span>
	  <span class="k">else</span>
	    <span class="o">{</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <ul>
<li>change RTSP state and print new state</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>	      <span class="n">state</span> <span class="o">=</span> <span class="n">READY</span><span class="o">;</span>
	      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;New RTSP state: READY&quot;</span><span class="o">);</span>
	    <span class="o">}</span>
	<span class="o">}</span><span class="c1">//else if state != INIT then do nothing</span>
    <span class="o">}</span>
  <span class="o">}</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <h3>Play button handler</h3>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">class</span> <span class="nc">playButtonListener</span> <span class="kd">implements</span> <span class="n">ActionListener</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">actionPerformed</span><span class="o">(</span><span class="n">ActionEvent</span> <span class="n">e</span><span class="o">){</span>

      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Play Button pressed !&quot;</span><span class="o">);</span>

      <span class="k">if</span> <span class="o">(</span><span class="n">state</span> <span class="o">==</span> <span class="n">READY</span><span class="o">)</span>
	<span class="o">{</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <ul>
<li>increase RTSP sequence number</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>	  <span class="n">RTSPSeqNb</span><span class="o">++;</span></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <ul>
<li>send PLAY message to the server</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>	  <span class="n">send_RTSP_request</span><span class="o">(</span><span class="s">&quot;PLAY&quot;</span><span class="o">);</span></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <ul>
<li>wait for the response</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>	  <span class="k">if</span> <span class="o">(</span><span class="n">parse_server_response</span><span class="o">()</span> <span class="o">!=</span> <span class="mi">200</span><span class="o">)</span>
		  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Invalid Server Response&quot;</span><span class="o">);</span>
	  <span class="k">else</span>
	    <span class="o">{</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <ul>
<li>change RTSP state and print out new state</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>	      <span class="n">state</span><span class="o">=</span><span class="n">PLAYING</span><span class="o">;</span>
	      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;New RTSP state: PLAYING&quot;</span><span class="o">);</span></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <ul>
<li>start the timer</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>	      <span class="n">timer</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
	    <span class="o">}</span>
	<span class="o">}</span><span class="c1">//else if state != READY then do nothing</span>
    <span class="o">}</span>
  <span class="o">}</span></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <h3>Pause button handler</h3>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">class</span> <span class="nc">pauseButtonListener</span> <span class="kd">implements</span> <span class="n">ActionListener</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">actionPerformed</span><span class="o">(</span><span class="n">ActionEvent</span> <span class="n">e</span><span class="o">){</span>

      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Pause Button pressed !&quot;</span><span class="o">);</span>

      <span class="k">if</span> <span class="o">(</span><span class="n">state</span> <span class="o">==</span> <span class="n">PLAYING</span><span class="o">)</span>
	<span class="o">{</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <ul>
<li>increase RTSP sequence number</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>	  <span class="n">RTSPSeqNb</span><span class="o">++;</span></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <ul>
<li>send PAUSE message to the server</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>	  <span class="n">send_RTSP_request</span><span class="o">(</span><span class="s">&quot;PAUSE&quot;</span><span class="o">);</span></pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <ul>
<li>wait for the response</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>	 <span class="k">if</span> <span class="o">(</span><span class="n">parse_server_response</span><span class="o">()</span> <span class="o">!=</span> <span class="mi">200</span><span class="o">)</span>
		  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Invalid Server Response&quot;</span><span class="o">);</span>
	  <span class="k">else</span>
	    <span class="o">{</span></pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <ul>
<li>change RTSP state and print out new state</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>	      <span class="n">state</span><span class="o">=</span><span class="n">READY</span><span class="o">;</span>
	      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;New RTSP state: READY&quot;</span><span class="o">);</span></pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <ul>
<li>stop the timer</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>	      <span class="n">timer</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span>
	    <span class="o">}</span>
	<span class="o">}</span><span class="c1">//else if state != PLAYING then do nothing</span>
    <span class="o">}</span>
  <span class="o">}</span></pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <h3>Teardown button handler</h3>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">class</span> <span class="nc">tearButtonListener</span> <span class="kd">implements</span> <span class="n">ActionListener</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">actionPerformed</span><span class="o">(</span><span class="n">ActionEvent</span> <span class="n">e</span><span class="o">){</span>

      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Teardown Button pressed !&quot;</span><span class="o">);</span></pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <ul>
<li>increase RTSP sequence number</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="n">RTSPSeqNb</span><span class="o">++;</span></pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <ul>
<li>send TEARDOWN message to the server</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="n">send_RTSP_request</span><span class="o">(</span><span class="s">&quot;TEARDOWN&quot;</span><span class="o">);</span></pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <ul>
<li>wait for the response</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="o">(</span><span class="n">parse_server_response</span><span class="o">()</span> <span class="o">!=</span> <span class="mi">200</span><span class="o">)</span>
	<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Invalid Server Response&quot;</span><span class="o">);</span>
      <span class="k">else</span>
	<span class="o">{</span></pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <ul>
<li>change RTSP state and print out new state</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="n">state</span><span class="o">=</span><span class="n">INIT</span><span class="o">;</span>
	  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;New RTSP state: INIT&quot;</span><span class="o">);</span></pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <ul>
<li>stop the timer</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>	  <span class="n">timer</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span></pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <ul>
<li>exit</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>	  <span class="n">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
	<span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
  </pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <h2>Handler for timer</h2>

<p><em>It read the data socket (RTPsocket) and display the frame every tick</em></p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">class</span> <span class="nc">timerListener</span> <span class="kd">implements</span> <span class="n">ActionListener</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">actionPerformed</span><span class="o">(</span><span class="n">ActionEvent</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span></pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <ul>
<li>construct a DatagramPacket to receive data from the UDP socket</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="n">rcvdp</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DatagramPacket</span><span class="o">(</span><span class="n">buf</span><span class="o">,</span> <span class="n">buf</span><span class="o">.</span><span class="na">length</span><span class="o">);</span>

      <span class="k">try</span><span class="o">{</span></pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <ul>
<li>receive the DP from the socket:</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="n">RTPsocket</span><span class="o">.</span><span class="na">receive</span><span class="o">(</span><span class="n">rcvdp</span><span class="o">);</span></pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <ul>
<li>create an RTPpacket object from the DP</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="n">RTPpacket</span> <span class="n">rtp_packet</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RTPpacket</span><span class="o">(</span><span class="n">rcvdp</span><span class="o">.</span><span class="na">getData</span><span class="o">(),</span> <span class="n">rcvdp</span><span class="o">.</span><span class="na">getLength</span><span class="o">());</span></pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <ul>
<li>print important header fields of the RTP packet received:</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Got RTP packet with SeqNum # &quot;</span><span class="o">+</span><span class="n">rtp_packet</span><span class="o">.</span><span class="na">getsequencenumber</span><span class="o">()+</span><span class="s">&quot; TimeStamp &quot;</span><span class="o">+</span><span class="n">rtp_packet</span><span class="o">.</span><span class="na">gettimestamp</span><span class="o">()+</span><span class="s">&quot; ms, of type &quot;</span><span class="o">+</span><span class="n">rtp_packet</span><span class="o">.</span><span class="na">getpayloadtype</span><span class="o">());</span></pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <ul>
<li>print header bitstream:</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="n">rtp_packet</span><span class="o">.</span><span class="na">printheader</span><span class="o">();</span></pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>               <ul>
<li>get the payload bitstream from the RTPpacket object</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="kt">int</span> <span class="n">payload_length</span> <span class="o">=</span> <span class="n">rtp_packet</span><span class="o">.</span><span class="na">getpayload_length</span><span class="o">();</span>
	<span class="kt">byte</span> <span class="o">[]</span> <span class="n">payload</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="n">payload_length</span><span class="o">];</span>
	<span class="n">rtp_packet</span><span class="o">.</span><span class="na">getpayload</span><span class="o">(</span><span class="n">payload</span><span class="o">);</span></pre></div>             </td>           </tr>                               <tr id="section-59">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-59">&#182;</a>               </div>               <ul>
<li>get an Image object from the payload bitstream</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="n">Toolkit</span> <span class="n">toolkit</span> <span class="o">=</span> <span class="n">Toolkit</span><span class="o">.</span><span class="na">getDefaultToolkit</span><span class="o">();</span>
	<span class="n">Image</span> <span class="n">image</span> <span class="o">=</span> <span class="n">toolkit</span><span class="o">.</span><span class="na">createImage</span><span class="o">(</span><span class="n">payload</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">payload_length</span><span class="o">);</span></pre></div>             </td>           </tr>                               <tr id="section-60">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-60">&#182;</a>               </div>               <ul>
<li>display the image as an ImageIcon object</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="n">icon</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ImageIcon</span><span class="o">(</span><span class="n">image</span><span class="o">);</span>
	<span class="n">iconLabel</span><span class="o">.</span><span class="na">setIcon</span><span class="o">(</span><span class="n">icon</span><span class="o">);</span>
      <span class="o">}</span>
      <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedIOException</span> <span class="n">iioe</span><span class="o">){</span>
	<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Nothing to read&quot;</span><span class="o">);</span>
      <span class="o">}</span>
      <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">ioe</span><span class="o">)</span> <span class="o">{</span>
	<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Exception caught: &quot;</span><span class="o">+</span><span class="n">ioe</span><span class="o">);</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span></pre></div>             </td>           </tr>                               <tr id="section-61">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-61">&#182;</a>               </div>               <h2>Parse Server Response</h2>

<p><em>Function use to read and parse the information sended by the server on the RTSP socket</em> <br />
<em>return 200 if OK, 0 else</em></p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">private</span> <span class="kt">int</span> <span class="nf">parse_server_response</span><span class="o">()</span>
  <span class="o">{</span>
    <span class="kt">int</span> <span class="n">reply_code</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>

    <span class="k">try</span><span class="o">{</span></pre></div>             </td>           </tr>                               <tr id="section-62">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-62">&#182;</a>               </div>               <p>parse status line and extract the reply_code:</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="n">String</span> <span class="n">StatusLine</span> <span class="o">=</span> <span class="n">RTSPBufferedReader</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;RTSP Client - Received from Server:&quot;</span><span class="o">);</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">StatusLine</span><span class="o">);</span>

      <span class="n">StringTokenizer</span> <span class="n">tokens</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringTokenizer</span><span class="o">(</span><span class="n">StatusLine</span><span class="o">);</span>
      <span class="n">tokens</span><span class="o">.</span><span class="na">nextToken</span><span class="o">();</span> <span class="c1">//skip over the RTSP version</span>
      <span class="n">reply_code</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">tokens</span><span class="o">.</span><span class="na">nextToken</span><span class="o">());</span></pre></div>             </td>           </tr>                               <tr id="section-63">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-63">&#182;</a>               </div>               <p>if reply code is OK get and print the 2 other lines</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="o">(</span><span class="n">reply_code</span> <span class="o">==</span> <span class="mi">200</span><span class="o">)</span>
	<span class="o">{</span>
	  <span class="n">String</span> <span class="n">SeqNumLine</span> <span class="o">=</span> <span class="n">RTSPBufferedReader</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
	  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">SeqNumLine</span><span class="o">);</span>

	  <span class="n">String</span> <span class="n">SessionLine</span> <span class="o">=</span> <span class="n">RTSPBufferedReader</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
	  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">SessionLine</span><span class="o">);</span></pre></div>             </td>           </tr>                               <tr id="section-64">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-64">&#182;</a>               </div>               <p>if state == INIT gets the Session Id from the SessionLine</p>             </td>             <td class="code">               <div class="highlight"><pre>	  <span class="n">tokens</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringTokenizer</span><span class="o">(</span><span class="n">SessionLine</span><span class="o">);</span>
	  <span class="n">tokens</span><span class="o">.</span><span class="na">nextToken</span><span class="o">();</span> <span class="c1">//skip over the Session:</span>
	  <span class="n">RTSPid</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">tokens</span><span class="o">.</span><span class="na">nextToken</span><span class="o">());</span>
	<span class="o">}</span>
    <span class="o">}</span>
    <span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span>
      <span class="o">{</span>
	<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Exception caught: &quot;</span><span class="o">+</span><span class="n">ex</span><span class="o">);</span>
	<span class="n">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
      <span class="o">}</span>

    <span class="k">return</span><span class="o">(</span><span class="n">reply_code</span><span class="o">);</span>
  <span class="o">}</span></pre></div>             </td>           </tr>                               <tr id="section-65">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-65">&#182;</a>               </div>               <h2>Send RTSP Request</h2>

<p><em>Send message to the server on the RTSP socket</em></p>

<p><em>Example of message:</em></p>

<pre><code>   PLAY movie.Mjpeg RTSP/1.0  
   CSeq: 2  
   Session: 123456  
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">private</span> <span class="kt">void</span> <span class="nf">send_RTSP_request</span><span class="o">(</span><span class="n">String</span> <span class="n">request_type</span><span class="o">)</span>
  <span class="o">{</span>
    <span class="k">try</span><span class="o">{</span></pre></div>             </td>           </tr>                               <tr id="section-66">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-66">&#182;</a>               </div>               <p>use the RTSPBufferedWriter to write to the RTSP socket</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-67">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-67">&#182;</a>               </div>               <p>write the request line</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="n">RTSPBufferedWriter</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">request_type</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span><span class="n">VideoFileName</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span><span class="s">&quot;RTSP/1.0&quot;</span><span class="o">+</span><span class="n">CRLF</span><span class="o">);</span></pre></div>             </td>           </tr>                               <tr id="section-68">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-68">&#182;</a>               </div>               <p>write the CSeq line</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="n">RTSPBufferedWriter</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="s">&quot;CSeq: &quot;</span><span class="o">+</span><span class="n">RTSPSeqNb</span><span class="o">+</span><span class="n">CRLF</span><span class="o">);</span></pre></div>             </td>           </tr>                               <tr id="section-69">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-69">&#182;</a>               </div>               <p>check if request type is equal to "SETUP" and in this case write the Transport: line advertising to the server the port used to receive the RTP packets RTP<em>RCV</em>PORT</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span><span class="o">(</span><span class="n">request_type</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;SETUP&quot;</span><span class="o">))</span> <span class="o">{</span>
          <span class="n">RTSPBufferedWriter</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="s">&quot;Transport: RTP/UDP; client_port= &quot;</span><span class="o">+</span><span class="n">RTP_RCV_PORT</span><span class="o">+</span><span class="n">CRLF</span><span class="o">);</span>
      <span class="o">}</span></pre></div>             </td>           </tr>                               <tr id="section-70">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-70">&#182;</a>               </div>               <p>otherwise, write the Session line from the RTSPid field</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">else</span> <span class="o">{</span>
          <span class="n">RTSPBufferedWriter</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="s">&quot;Session: &quot;</span><span class="o">+</span><span class="n">RTSPid</span><span class="o">+</span><span class="n">CRLF</span><span class="o">);</span>
      <span class="o">}</span>

      <span class="n">RTSPBufferedWriter</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span>
      <span class="o">{</span>
	<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Exception caught: &quot;</span><span class="o">+</span><span class="n">ex</span><span class="o">);</span>
      <span class="o">}</span>
  <span class="o">}</span>

<span class="o">}</span><span class="c1">//end of Class Client</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 